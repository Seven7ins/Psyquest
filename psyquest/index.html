<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#7c3aed">
  <meta name="description" content="PsyQuest â€“ Therapeutisches Gruppenspiel fÃ¼r Therapiesitzungen">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>PsyQuest â€“ Therapeutic Group Game</title>

  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/png" href="icons/icon-192.png">
  <link rel="apple-touch-icon" href="icons/icon-192.png">

  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-gray-900 text-white min-h-screen">

  <!-- ===================== SPLASH / LANDING SCREEN ===================== -->
  <section id="screen-landing" class="screen active">
    <div class="flex flex-col items-center justify-center min-h-screen px-4 text-center">
      <div class="animate-float">
        <div class="text-8xl mb-4">ğŸ§ </div>
      </div>
      <h1 class="font-display text-5xl md:text-6xl text-purple-400 mb-2">PsyQuest</h1>
      <p class="text-gray-400 text-lg mb-8 max-w-md">Gemeinsam innere DÃ¤monen besiegen â€“ ein therapeutisches Gruppenspiel</p>
      
      <div class="space-y-4 w-full max-w-xs">
        <button onclick="App.showScreen('screen-therapist-setup')" class="btn-primary w-full">
          ğŸ©º Therapeut â€“ Session starten
        </button>
        <button onclick="App.showScreen('screen-player-join')" class="btn-secondary w-full">
          ğŸ® Spieler â€“ Session beitreten
        </button>
      </div>
      
      <p class="text-gray-600 text-sm mt-8">Kein Account nÃ¶tig Â· Keine Installation Â· DSGVO-konform</p>
    </div>
  </section>

  <!-- ===================== THERAPIST SETUP SCREEN ===================== -->
  <section id="screen-therapist-setup" class="screen">
    <div class="max-w-2xl mx-auto px-4 py-8">
      <button onclick="App.showScreen('screen-landing')" class="text-gray-400 hover:text-white mb-6 inline-flex items-center">
        â† ZurÃ¼ck
      </button>
      
      <h2 class="font-display text-3xl text-purple-400 mb-6">Session konfigurieren</h2>
      
      <div class="card mb-6">
        <h3 class="text-lg font-semibold mb-4">ğŸ“‹ Grundeinstellungen</h3>
        
        <label class="block mb-4">
          <span class="text-gray-300 text-sm">Gruppenname (optional)</span>
          <input type="text" id="group-name" placeholder="z.B. Donnerstag-Gruppe" 
                 class="input-field mt-1">
        </label>

        <label class="block mb-4">
          <span class="text-gray-300 text-sm">StÃ¶rungsschwerpunkt</span>
          <select id="disorder-focus" class="input-field mt-1">
            <option value="mixed">Gemischt / Allgemein</option>
            <option value="depression">Depression</option>
            <option value="anxiety">AngststÃ¶rung</option>
            <option value="social-phobia">Soziale Phobie</option>
            <option value="stress">Stressmanagement</option>
            <option value="dbt-skills">DBT Skills</option>
            <option value="cbt-focus">CBT Fokus</option>
          </select>
        </label>

        <label class="block mb-4">
          <span class="text-gray-300 text-sm">Altersgruppe</span>
          <select id="age-group" class="input-field mt-1">
            <option value="teens">Jugendliche (14â€“17)</option>
            <option value="adults" selected>Erwachsene (18+)</option>
          </select>
        </label>

        <label class="block mb-4">
          <span class="text-gray-300 text-sm">AnonymitÃ¤tsmodus (fÃ¼r Sozialphobie)</span>
          <div class="flex items-center mt-2">
            <input type="checkbox" id="anonymity-mode" class="toggle-checkbox">
            <span class="text-gray-400 text-sm ml-2">Sticker-Chat statt Freitext aktivieren</span>
          </div>
        </label>
      </div>

      <div class="card mb-6">
        <h3 class="text-lg font-semibold mb-4">ğŸ® Spielmodus wÃ¤hlen</h3>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <button onclick="App.selectGameMode('escape-room')" class="game-mode-card" data-mode="escape-room">
            <div class="text-4xl mb-2">ğŸ°</div>
            <div class="font-semibold">Escape Room</div>
            <div class="text-sm text-gray-400">Flucht aus dem Angst-Labyrinth</div>
            <div class="badge-coop mt-2">Kooperativ</div>
          </button>
          
          <button onclick="App.selectGameMode('boss-fight')" class="game-mode-card" data-mode="boss-fight">
            <div class="text-4xl mb-2">âš”ï¸</div>
            <div class="font-semibold">Boss Fight</div>
            <div class="text-sm text-gray-400">Kampf gegen innere DÃ¤monen</div>
            <div class="badge-coop mt-2">Kooperativ</div>
          </button>
          
          <button onclick="App.selectGameMode('empathy-duel')" class="game-mode-card" data-mode="empathy-duel">
            <div class="text-4xl mb-2">ğŸ’¬</div>
            <div class="font-semibold">Empathie-Duell</div>
            <div class="text-sm text-gray-400">Wer zeigt mehr MitgefÃ¼hl?</div>
            <div class="badge-comp mt-2">Freundlich Kompetitiv</div>
          </button>
          
          <button onclick="App.selectGameMode('skill-race')" class="game-mode-card" data-mode="skill-race">
            <div class="text-4xl mb-2">ğŸƒ</div>
            <div class="font-semibold">Skill Race</div>
            <div class="text-sm text-gray-400">Schnellste Coping-Strategie</div>
            <div class="badge-comp mt-2">Freundlich Kompetitiv</div>
          </button>
          
          <button onclick="App.selectGameMode('perspective-battle')" class="game-mode-card" data-mode="perspective-battle">
            <div class="text-4xl mb-2">ğŸ”®</div>
            <div class="font-semibold">Perspektiv-Battle</div>
            <div class="text-sm text-gray-400">Blick aus dem starken Ich</div>
            <div class="badge-comp mt-2">Freundlich Kompetitiv</div>
          </button>
        </div>
      </div>

      <div class="card mb-6" id="quest-selection" style="display:none;">
        <h3 class="text-lg font-semibold mb-4">ğŸ—ºï¸ Quest auswÃ¤hlen</h3>
        <div id="quest-list" class="space-y-3"></div>
      </div>

      <button onclick="App.createSession()" class="btn-primary w-full text-lg py-4" id="btn-create-session">
        ğŸš€ Session erstellen
      </button>
    </div>
  </section>

  <!-- ===================== THERAPIST DASHBOARD (QR + Lobby) ===================== -->
  <section id="screen-therapist-dashboard" class="screen">
    <div class="max-w-4xl mx-auto px-4 py-8">
      <div class="flex items-center justify-between mb-6">
        <h2 class="font-display text-2xl text-purple-400">Therapeuten-Dashboard</h2>
        <button onclick="App.endSession()" class="btn-danger text-sm">Session beenden</button>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- QR Code Panel -->
        <div class="card text-center">
          <h3 class="text-lg font-semibold mb-4">ğŸ“± QR-Code zum Beitreten</h3>
          <div id="qr-code-container" class="bg-white p-6 rounded-xl inline-block mb-4"></div>
          <div class="mt-2">
            <p class="text-gray-400 text-sm">Session-Code:</p>
            <p class="text-2xl font-mono font-bold text-purple-400" id="session-code-display">---</p>
            <p class="text-gray-500 text-xs mt-2" id="session-link"></p>
          </div>
        </div>

        <!-- Players Panel -->
        <div class="card">
          <h3 class="text-lg font-semibold mb-4">
            ğŸ‘¥ Spieler (<span id="player-count">0</span>/12)
          </h3>
          <div id="player-list" class="space-y-2 max-h-64 overflow-y-auto"></div>
          <div class="mt-4 pt-4 border-t border-gray-700">
            <p class="text-gray-400 text-sm mb-2">Warte auf mindestens 4 Spieler...</p>
            <div class="w-full bg-gray-700 rounded-full h-2">
              <div id="player-progress" class="bg-purple-500 h-2 rounded-full transition-all" style="width: 0%"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Game Controls -->
      <div class="card mt-6">
        <div class="flex items-center justify-between">
          <div>
            <h3 class="text-lg font-semibold">Spielsteuerung</h3>
            <p class="text-gray-400 text-sm" id="selected-mode-display">Modus: ---</p>
          </div>
          <button onclick="App.startGame()" id="btn-start-game" class="btn-primary" disabled>
            â–¶ Spiel starten
          </button>
        </div>
      </div>

      <!-- Therapist Chat / Notes -->
      <div class="card mt-6">
        <h3 class="text-lg font-semibold mb-4">ğŸ“ Therapeuten-Notizen & Moderation</h3>
        <div id="therapist-chat" class="bg-gray-800 rounded-lg p-4 h-32 overflow-y-auto mb-4 text-sm text-gray-300">
          <p class="text-gray-500 italic">Session-Notizen erscheinen hier...</p>
        </div>
        <div class="flex gap-2">
          <input type="text" id="therapist-message" placeholder="Nachricht an Gruppe senden..." class="input-field flex-1">
          <button onclick="App.sendTherapistMessage()" class="btn-primary px-6">Senden</button>
        </div>
      </div>
    </div>
  </section>

  <!-- ===================== PLAYER JOIN SCREEN ===================== -->
  <section id="screen-player-join" class="screen">
    <div class="flex flex-col items-center justify-center min-h-screen px-4 text-center">
      <button onclick="App.showScreen('screen-landing')" class="text-gray-400 hover:text-white mb-6 self-start ml-4">
        â† ZurÃ¼ck
      </button>
      
      <div class="text-6xl mb-4">ğŸ®</div>
      <h2 class="font-display text-3xl text-purple-400 mb-2">Session beitreten</h2>
      <p class="text-gray-400 mb-8">Gib den Session-Code ein oder scanne den QR-Code</p>
      
      <div class="w-full max-w-xs space-y-4">
        <input type="text" id="join-code" placeholder="Session-Code eingeben" 
               class="input-field text-center text-2xl tracking-widest uppercase" maxlength="6">
        
        <button onclick="App.joinSession()" class="btn-primary w-full" id="btn-join">
          Beitreten
        </button>
      </div>

      <div id="join-error" class="text-red-400 text-sm mt-4 hidden"></div>
    </div>
  </section>

  <!-- ===================== PLAYER LOBBY ===================== -->
  <section id="screen-player-lobby" class="screen">
    <div class="flex flex-col items-center justify-center min-h-screen px-4 text-center">
      <div class="animate-pulse text-6xl mb-4" id="my-avatar-display">ğŸ¦</div>
      <h2 class="font-display text-2xl text-purple-400 mb-1" id="my-avatar-name">Mutiger LÃ¶we</h2>
      <p class="text-gray-400 mb-8">Warte auf den Therapeuten...</p>
      
      <div class="card w-full max-w-md">
        <h3 class="text-lg font-semibold mb-4">Mitspieler im Raum</h3>
        <div id="lobby-players" class="flex flex-wrap justify-center gap-4"></div>
      </div>

      <div class="mt-6 text-gray-500 text-sm">
        <div class="loading-dots">
          <span></span><span></span><span></span>
        </div>
        <p class="mt-2">Das Spiel startet gleich...</p>
      </div>
    </div>
  </section>

  <!-- ===================== ESCAPE ROOM GAME ===================== -->
  <section id="screen-escape-room" class="screen">
    <div class="max-w-2xl mx-auto px-4 py-4">
      <!-- Game Header -->
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center gap-3">
          <span class="text-3xl">ğŸ°</span>
          <div>
            <h2 class="font-display text-xl text-purple-400">Angst-Labyrinth</h2>
            <p class="text-gray-400 text-xs" id="escape-room-name">Raum 1 von 4</p>
          </div>
        </div>
        <div class="text-right">
          <div class="text-sm text-gray-400">Verbleibend</div>
          <div class="font-mono text-xl text-yellow-400" id="escape-timer">15:00</div>
        </div>
      </div>

      <!-- Group Progress Bar -->
      <div class="mb-6">
        <div class="flex items-center justify-between text-sm mb-1">
          <span class="text-gray-400">Gruppenfortschritt</span>
          <span class="text-purple-400 font-semibold" id="escape-progress-text">0%</span>
        </div>
        <div class="progress-bar-container">
          <div id="escape-progress-bar" class="progress-bar-fill" style="width: 0%"></div>
        </div>
      </div>

      <!-- Room Visual -->
      <div id="escape-room-visual" class="card mb-4 relative overflow-hidden min-h-48">
        <div id="room-scene" class="text-center py-8">
          <div class="text-6xl mb-4 animate-float" id="room-monster">ğŸ‘¹</div>
          <p class="text-lg font-semibold" id="room-title">Der Anxiety Monster blockiert die TÃ¼r!</p>
          <p class="text-gray-400 text-sm mt-2" id="room-description">LÃ¶st das RÃ¤tsel gemeinsam, um voranzukommen.</p>
        </div>
      </div>

      <!-- Puzzle Area -->
      <div id="escape-puzzle-area" class="card mb-4">
        <!-- Dynamically populated by games.js -->
      </div>

      <!-- Player Contributions -->
      <div class="card">
        <h4 class="text-sm font-semibold text-gray-400 mb-3">BeitrÃ¤ge der Gruppe</h4>
        <div id="escape-contributions" class="space-y-2 max-h-40 overflow-y-auto"></div>
      </div>

      <!-- Therapist Message Banner -->
      <div id="escape-therapist-msg" class="therapist-banner hidden mt-4">
        <span class="text-sm">ğŸ©º </span>
        <span id="escape-therapist-msg-text" class="text-sm"></span>
      </div>
    </div>
  </section>

  <!-- ===================== BOSS FIGHT GAME ===================== -->
  <section id="screen-boss-fight" class="screen">
    <div class="max-w-2xl mx-auto px-4 py-4">
      <!-- Boss Header -->
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center gap-3">
          <span class="text-3xl">âš”ï¸</span>
          <div>
            <h2 class="font-display text-xl text-red-400" id="boss-name">Anxiety Monster</h2>
            <p class="text-gray-400 text-xs" id="boss-round-display">Runde 1 von 5</p>
          </div>
        </div>
        <div class="text-right">
          <div class="text-sm text-gray-400">Zeit</div>
          <div class="font-mono text-xl text-yellow-400" id="boss-timer">15:00</div>
        </div>
      </div>

      <!-- Boss HP Bar -->
      <div class="mb-4">
        <div class="flex items-center justify-between text-sm mb-1">
          <span class="text-red-400 font-semibold" id="boss-display-name">ğŸ˜ˆ Anxiety Monster</span>
          <span class="text-red-400 font-semibold" id="boss-hp-text">100 HP</span>
        </div>
        <div class="progress-bar-container">
          <div id="boss-hp-bar" class="bg-red-500 h-full rounded-full transition-all duration-700" style="width: 100%"></div>
        </div>
      </div>

      <!-- Boss Visual -->
      <div class="card mb-4 text-center boss-arena">
        <div class="text-7xl mb-2 animate-shake" id="boss-sprite">ğŸ‘¹</div>
        <div id="boss-attack-text" class="text-lg font-semibold text-red-300 mb-2"></div>
        <div id="boss-scenario" class="text-gray-300 text-sm"></div>
      </div>

      <!-- Attack Options -->
      <div id="boss-action-area" class="card mb-4">
        <!-- Dynamically populated -->
      </div>

      <!-- Team Stats -->
      <div class="grid grid-cols-2 gap-4">
        <div class="card text-center">
          <div class="text-2xl font-bold text-green-400" id="team-damage">0</div>
          <div class="text-xs text-gray-400">Team-Schaden</div>
        </div>
        <div class="card text-center">
          <div class="text-2xl font-bold text-blue-400" id="team-combo">0x</div>
          <div class="text-xs text-gray-400">Combo-Streak</div>
        </div>
      </div>

      <!-- Group Actions Log -->
      <div class="card mt-4">
        <h4 class="text-sm font-semibold text-gray-400 mb-3">Kampflog</h4>
        <div id="boss-fight-log" class="space-y-1 max-h-32 overflow-y-auto text-sm"></div>
      </div>

      <!-- Therapist Message Banner -->
      <div id="boss-therapist-msg" class="therapist-banner hidden mt-4">
        <span class="text-sm">ğŸ©º </span>
        <span id="boss-therapist-msg-text" class="text-sm"></span>
      </div>
    </div>
  </section>

  <!-- ===================== COMPETITIVE GAMES SCREEN ===================== -->
  <section id="screen-competitive" class="screen">
    <div class="max-w-2xl mx-auto px-4 py-4">
      <!-- Header -->
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center gap-3">
          <span class="text-3xl" id="comp-mode-icon">ğŸ’¬</span>
          <div>
            <h2 class="font-display text-xl text-yellow-400" id="comp-mode-title">Empathie-Duell</h2>
            <p class="text-gray-400 text-xs" id="comp-round-display">Runde 1 von 5</p>
          </div>
        </div>
        <div class="text-right">
          <div class="text-sm text-gray-400">Zeit</div>
          <div class="font-mono text-xl text-yellow-400" id="comp-timer">02:00</div>
        </div>
      </div>

      <!-- Scoreboard -->
      <div id="comp-scoreboard" class="card mb-4">
        <div class="flex items-center justify-between text-sm mb-2">
          <span class="text-gray-400">Punktestand</span>
        </div>
        <div id="comp-scores" class="flex flex-wrap gap-3"></div>
      </div>

      <!-- Scenario Display -->
      <div class="card mb-4">
        <div class="text-center">
          <p class="text-gray-400 text-xs mb-2">Szenario</p>
          <p class="text-lg font-semibold" id="comp-scenario-text"></p>
        </div>
      </div>

      <!-- Action Area -->
      <div id="comp-action-area" class="card mb-4">
        <!-- Dynamically populated by competitive.js -->
      </div>

      <!-- Voting Area (hidden by default) -->
      <div id="comp-voting-area" class="card mb-4 hidden">
        <h4 class="text-sm font-semibold text-gray-400 mb-3">Abstimmung</h4>
        <div id="comp-vote-options" class="space-y-3"></div>
      </div>

      <!-- Results area -->
      <div id="comp-results-area" class="card mb-4 hidden"></div>

      <!-- Therapist Message Banner -->
      <div id="comp-therapist-msg" class="therapist-banner hidden mt-4">
        <span class="text-sm">ğŸ©º </span>
        <span id="comp-therapist-msg-text" class="text-sm"></span>
      </div>
    </div>
  </section>

  <!-- ===================== VICTORY SCREEN ===================== -->
  <section id="screen-victory" class="screen">
    <div class="flex flex-col items-center justify-center min-h-screen px-4 text-center">
      <div class="confetti-container" id="confetti-container"></div>
      
      <div class="animate-bounce-slow">
        <div class="text-8xl mb-4" id="victory-icon">ğŸ†</div>
      </div>
      
      <h2 class="font-display text-4xl text-yellow-400 mb-2" id="victory-title">Geschafft!</h2>
      <p class="text-gray-300 text-lg mb-6" id="victory-subtitle">Ihr habt den Anxiety Monster besiegt!</p>
      
      <!-- Stats -->
      <div class="grid grid-cols-3 gap-4 w-full max-w-md mb-6">
        <div class="card text-center">
          <div class="text-2xl font-bold text-purple-400" id="victory-stat-1">0</div>
          <div class="text-xs text-gray-400">BeitrÃ¤ge</div>
        </div>
        <div class="card text-center">
          <div class="text-2xl font-bold text-green-400" id="victory-stat-2">0</div>
          <div class="text-xs text-gray-400">RÃ¤tsel gelÃ¶st</div>
        </div>
        <div class="card text-center">
          <div class="text-2xl font-bold text-yellow-400" id="victory-stat-3">15:00</div>
          <div class="text-xs text-gray-400">Spielzeit</div>
        </div>
      </div>

      <!-- Badges Earned -->
      <div class="card w-full max-w-md mb-6">
        <h3 class="text-lg font-semibold mb-3">ğŸ… Verdiente Badges</h3>
        <div id="victory-badges" class="flex flex-wrap justify-center gap-3"></div>
      </div>

      <!-- Team MVP -->
      <div class="card w-full max-w-md mb-6" id="victory-mvp-card">
        <h3 class="text-lg font-semibold mb-3">â­ Team-Highlight</h3>
        <div id="victory-mvp" class="text-center"></div>
      </div>

      <button onclick="App.startDebrief()" class="btn-primary w-full max-w-xs text-lg py-4">
        ğŸ’­ Zur Reflexion
      </button>
    </div>
  </section>

  <!-- ===================== DEBRIEF / REFLECTION SCREEN ===================== -->
  <section id="screen-debrief" class="screen">
    <div class="max-w-2xl mx-auto px-4 py-8">
      <div class="text-center mb-8">
        <div class="text-5xl mb-2">ğŸ’­</div>
        <h2 class="font-display text-3xl text-purple-400">Reflexion</h2>
        <p class="text-gray-400">Nehmt euch einen Moment...</p>
        <div class="font-mono text-yellow-400 mt-2" id="debrief-timer">03:00</div>
      </div>

      <!-- Reflection Questions -->
      <div id="debrief-questions" class="space-y-6"></div>

      <!-- Sticker Reactions (for anonymity mode) -->
      <div id="sticker-area" class="card mt-6 hidden">
        <h4 class="text-sm font-semibold text-gray-400 mb-3">Reagiere mit Stickern</h4>
        <div class="flex flex-wrap gap-2 justify-center" id="sticker-options">
          <button onclick="App.sendSticker('ğŸ’ª')" class="sticker-btn">ğŸ’ª</button>
          <button onclick="App.sendSticker('â¤ï¸')" class="sticker-btn">â¤ï¸</button>
          <button onclick="App.sendSticker('ğŸŒŸ')" class="sticker-btn">ğŸŒŸ</button>
          <button onclick="App.sendSticker('ğŸ¤—')" class="sticker-btn">ğŸ¤—</button>
          <button onclick="App.sendSticker('ğŸ§˜')" class="sticker-btn">ğŸ§˜</button>
          <button onclick="App.sendSticker('ğŸ¯')" class="sticker-btn">ğŸ¯</button>
          <button onclick="App.sendSticker('ğŸŒˆ')" class="sticker-btn">ğŸŒˆ</button>
          <button onclick="App.sendSticker('ğŸ”¥')" class="sticker-btn">ğŸ”¥</button>
          <button onclick="App.sendSticker('ğŸ¦‹')" class="sticker-btn">ğŸ¦‹</button>
          <button onclick="App.sendSticker('âœ¨')" class="sticker-btn">âœ¨</button>
        </div>
        <div id="sticker-feed" class="flex flex-wrap gap-1 mt-3 justify-center"></div>
      </div>

      <!-- Group Answers -->
      <div class="card mt-6">
        <h4 class="text-sm font-semibold text-gray-400 mb-3">Antworten der Gruppe</h4>
        <div id="debrief-answers" class="space-y-2 max-h-64 overflow-y-auto"></div>
      </div>

      <!-- Therapist Controls (therapist only) -->
      <div id="debrief-therapist-controls" class="card mt-6 hidden">
        <h4 class="text-sm font-semibold text-gray-400 mb-3">ğŸ©º Therapeuten-Steuerung</h4>
        <div class="flex gap-2 mb-4">
          <button onclick="App.nextDebriefQuestion()" class="btn-secondary flex-1">NÃ¤chste Frage</button>
          <button onclick="App.showScreen('screen-therapist-dashboard')" class="btn-primary flex-1">ZurÃ¼ck zum Dashboard</button>
        </div>
        <label class="block">
          <span class="text-gray-300 text-sm">Notiz speichern</span>
          <textarea id="therapist-note" rows="3" class="input-field mt-1" placeholder="Beobachtungen zur Gruppendynamik..."></textarea>
        </label>
        <button onclick="App.saveTherapistNote()" class="btn-secondary mt-2 w-full">Notiz speichern</button>
      </div>

      <button onclick="App.endDebrief()" class="btn-primary w-full mt-6" id="btn-end-debrief">
        Weiter
      </button>
    </div>
  </section>

  <!-- ===================== CONSENT MODAL ===================== -->
  <div id="consent-modal" class="modal hidden">
    <div class="modal-content">
      <h3 class="font-display text-xl text-purple-400 mb-4">ğŸ”’ Datenschutz & Einwilligung</h3>
      <div class="text-sm text-gray-300 space-y-2 mb-6">
        <p>PsyQuest speichert nur anonyme Spielfortschritte. Es werden <strong>keine persÃ¶nlichen Daten</strong> erfasst.</p>
        <p>Alle Daten werden verschlÃ¼sselt Ã¼bertragen und nach der Session automatisch gelÃ¶scht (sofern nicht vom Therapeuten anders konfiguriert).</p>
        <p>Die Teilnahme ist freiwillig. Du kannst jederzeit aufhÃ¶ren.</p>
        <p class="text-gray-400">DSGVO-konform Â· Keine Tracking-Cookies Â· Open Source</p>
      </div>
      <div class="flex gap-3">
        <button onclick="App.acceptConsent()" class="btn-primary flex-1">Einverstanden</button>
        <button onclick="App.declineConsent()" class="btn-secondary flex-1">Ablehnen</button>
      </div>
    </div>
  </div>

  <!-- ===================== NOTIFICATION TOAST ===================== -->
  <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2"></div>

  <!-- ===================== SCRIPTS ===================== -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
  
  <!-- Firebase SDK (v9 compat) -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

  <script src="js/firebase-config.js"></script>
  <script src="js/data.js"></script>
  <script src="js/games.js"></script>
  <script src="js/competitive.js"></script>
  <script src="js/app.js"></script>

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js')
          .then(reg => console.log('SW registered:', reg.scope))
          .catch(err => console.log('SW registration failed:', err));
      });
    }
  </script>
</body>
</html>
